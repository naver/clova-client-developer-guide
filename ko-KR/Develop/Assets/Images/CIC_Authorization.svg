<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1477px" preserveAspectRatio="none" style="width:856px;height:1477px;" version="1.1" viewBox="0 0 856 1477" width="856px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="224.56" style="stroke:#000000;stroke-width:1.0;" width="10" x="99.5" y="1237"/><rect fill="#FFFFFF" height="295.32" style="stroke:#000000;stroke-width:1.0;" width="10" x="279.5" y="70.72"/><rect fill="#FFFFFF" height="30" style="stroke:#000000;stroke-width:1.0;" width="10" x="279.5" y="487.32"/><rect fill="#FFFFFF" height="610.4" style="stroke:#000000;stroke-width:1.0;" width="10" x="279.5" y="626.6"/><rect fill="#FFFFFF" height="69.52" style="stroke:#000000;stroke-width:1.0;" width="10" x="517.5" y="179.24"/><rect fill="#FFFFFF" height="494.36" style="stroke:#000000;stroke-width:1.0;" width="10" x="688.5" y="336.04"/><rect fill="#FFFFFF" height="51.76" style="stroke:#000000;stroke-width:1.0;" width="10" x="688.5" y="1011.96"/><rect fill="#FFFFFF" height="51.76" style="stroke:#000000;stroke-width:1.0;" width="10" x="688.5" y="1342.04"/><rect fill="#FFFFFF" height="30" style="stroke:#000000;stroke-width:1.0;" width="10" x="805.5" y="1115.48"/><rect fill="#FFFFFF" height="16" style="stroke:#000000;stroke-width:1.0;" width="10" x="805.5" y="1445.56"/><rect fill="#FFFFFF" height="457.36" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="585.5" x="196.5" y="381.04"/><rect fill="#FFFFFF" height="313.08" style="stroke:none;stroke-width:1.0;" width="585.5" x="196.5" y="525.32"/><rect fill="#FFFFFF" height="601.16" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="839" x="10" y="852.4"/><rect fill="#FFFFFF" height="300.08" style="stroke:none;stroke-width:1.0;" width="839" x="10" y="1153.48"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="104" x2="104" y1="60.72" y2="1470.56"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="284.5" x2="284.5" y1="60.72" y2="1470.56"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="522" x2="522" y1="60.72" y2="1470.56"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="693" x2="693" y1="60.72" y2="1470.56"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="810" x2="810" y1="60.72" y2="1470.56"/><rect fill="#9EA0CA" height="54.72" rx="5" ry="5" style="stroke:#FFFFFF;stroke-width:1.5;" width="169" x="20" y="5"/><text fill="#FFFFFF" font-family="Noto Sans CJK KR" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="135" x="37" y="38.24">GUI 미제공 클라이언트</text><rect fill="#9EA0CA" height="54.72" rx="5" ry="5" style="stroke:#FFFFFF;stroke-width:1.5;" width="156" x="206.5" y="5"/><text fill="#FFFFFF" font-family="Noto Sans CJK KR" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="122" x="223.5" y="38.24">GUI 제공 클라이언트</text><rect fill="#05D686" height="54.72" rx="5" ry="5" style="stroke:#FFFFFF;stroke-width:1.5;" width="139" x="453" y="5"/><text fill="#FFFFFF" font-family="Noto Sans CJK KR" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="105" x="470" y="38.24">NAVER 인증 서버</text><rect fill="#05D686" height="54.72" rx="5" ry="5" style="stroke:#FFFFFF;stroke-width:1.5;" width="157" x="615" y="5"/><text fill="#FFFFFF" font-family="Noto Sans CJK KR" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="123" x="632" y="38.24">클라이언트 인증 서버</text><rect fill="#05D686" height="54.72" rx="5" ry="5" style="stroke:#FFFFFF;stroke-width:1.5;" width="57" x="782" y="5"/><text fill="#FFFFFF" font-family="Noto Sans CJK KR" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="23" x="799" y="38.24">CIC</text><rect fill="#FFFFFF" height="224.56" style="stroke:#000000;stroke-width:1.0;" width="10" x="99.5" y="1237"/><rect fill="#FFFFFF" height="295.32" style="stroke:#000000;stroke-width:1.0;" width="10" x="279.5" y="70.72"/><rect fill="#FFFFFF" height="30" style="stroke:#000000;stroke-width:1.0;" width="10" x="279.5" y="487.32"/><rect fill="#FFFFFF" height="610.4" style="stroke:#000000;stroke-width:1.0;" width="10" x="279.5" y="626.6"/><rect fill="#FFFFFF" height="69.52" style="stroke:#000000;stroke-width:1.0;" width="10" x="517.5" y="179.24"/><rect fill="#FFFFFF" height="494.36" style="stroke:#000000;stroke-width:1.0;" width="10" x="688.5" y="336.04"/><rect fill="#FFFFFF" height="51.76" style="stroke:#000000;stroke-width:1.0;" width="10" x="688.5" y="1011.96"/><rect fill="#FFFFFF" height="51.76" style="stroke:#000000;stroke-width:1.0;" width="10" x="688.5" y="1342.04"/><rect fill="#FFFFFF" height="30" style="stroke:#000000;stroke-width:1.0;" width="10" x="805.5" y="1115.48"/><rect fill="#FFFFFF" height="16" style="stroke:#000000;stroke-width:1.0;" width="10" x="805.5" y="1445.56"/><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="331.5" y1="114.48" y2="114.48"/><line style="stroke:#000000;stroke-width:1.0;" x1="331.5" x2="331.5" y1="114.48" y2="127.48"/><line style="stroke:#000000;stroke-width:1.0;" x1="290.5" x2="331.5" y1="127.48" y2="127.48"/><polygon fill="#000000" points="300.5,123.48,290.5,127.48,300.5,131.48,296.5,127.48" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="74" x="306.5" y="98.64">NAVER 로그인</text><line style="stroke:#000000;stroke-width:1.0;" x1="515.5" x2="505.5" y1="179.24" y2="175.24"/><line style="stroke:#000000;stroke-width:1.0;" x1="515.5" x2="505.5" y1="179.24" y2="183.24"/><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="516.5" y1="179.24" y2="179.24"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="113" x="347" y="163.4">NAVER 계정 정보 전달</text><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="299.5" y1="248.76" y2="244.76"/><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="299.5" y1="248.76" y2="252.76"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="289.5" x2="521.5" y1="248.76" y2="248.76"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="63" x="374.5" y="215.16">NAVER 계정</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="99" x="356.5" y="232.92">access token 전달</text><line style="stroke:#000000;stroke-width:1.0;" x1="686.5" x2="676.5" y1="336.04" y2="332.04"/><line style="stroke:#000000;stroke-width:1.0;" x1="686.5" x2="676.5" y1="336.04" y2="340.04"/><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="687.5" y1="336.04" y2="336.04"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="222" x="352" y="284.68">authorization code 요청(다음 정보를 전달)</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="147" x="352" y="302.44">- NAVER 계정 access token</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="274" x="352" y="320.2">- 클라이언트 인증 정보(CLOVA_OAUTH_CLIENT_ID)</text><path d="M201.5,381.04 L277.5,381.04 L277.5,410.04 L267.5,420.04 L196.5,420.04 L196.5,386.04 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="457.36" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="585.5" x="196.5" y="381.04"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="16" x="221.5" y="405.96">alt</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="249" x="302.5" y="406.96">["사용자 약관 동의 여부" == "동의 완료한 상태"]</text><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="299.5" y1="487.32" y2="483.32"/><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="299.5" y1="487.32" y2="491.32"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="289.5" x2="687.5" y1="487.32" y2="487.32"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="180" x="399" y="471.48">authorization code 전달(200 OK)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="196.5" x2="782" y1="526.32" y2="526.32"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="260" x="211.5" y="550.24">["사용자 약관 동의 여부" == "동의하지 않은 상태"]</text><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="299.5" y1="626.6" y2="622.6"/><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="299.5" y1="626.6" y2="630.6"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="289.5" x2="687.5" y1="626.6" y2="626.6"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="174" x="386.5" y="593">authorization, redirect_uri 전달</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="205" x="386.5" y="610.76">(451 Unavailable For Legal Reasons)</text><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="331.5" y1="678.36" y2="678.36"/><line style="stroke:#000000;stroke-width:1.0;" x1="331.5" x2="331.5" y1="678.36" y2="691.36"/><line style="stroke:#000000;stroke-width:1.0;" x1="290.5" x2="331.5" y1="691.36" y2="691.36"/><polygon fill="#000000" points="300.5,687.36,290.5,691.36,300.5,695.36,296.5,691.36" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="194" x="306.5" y="662.52">이용 약관 페이지(redirect_uri)로 이동</text><line style="stroke:#000000;stroke-width:1.0;" x1="686.5" x2="676.5" y1="743.12" y2="739.12"/><line style="stroke:#000000;stroke-width:1.0;" x1="686.5" x2="676.5" y1="743.12" y2="747.12"/><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="687.5" y1="743.12" y2="743.12"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="216" x="381" y="727.28">사용자의 이용 약관 동의 결과 전송(submit)</text><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="299.5" y1="830.4" y2="826.4"/><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="299.5" y1="830.4" y2="834.4"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="289.5" x2="692.5" y1="830.4" y2="830.4"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="114" x="397.5" y="779.04">결과 전달(302 Found)</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="188" x="397.5" y="796.8">- 성공: clova://agreement-success</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="180" x="397.5" y="814.56">- 실패: clova://agreement-failure</text><path d="M15,852.4 L91,852.4 L91,881.4 L81,891.4 L10,891.4 L10,857.4 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="601.16" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="839" x="10" y="852.4"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="877.32">alt</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="243" x="116" y="878.32">["클라이언트 타입" == "GUI 제공 클라이언트"]</text><line style="stroke:#000000;stroke-width:1.0;" x1="686.5" x2="676.5" y1="1011.96" y2="1007.96"/><line style="stroke:#000000;stroke-width:1.0;" x1="686.5" x2="676.5" y1="1011.96" y2="1015.96"/><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="687.5" y1="1011.96" y2="1011.96"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="229" x="309" y="942.84">CLOVA access token 요청, 다음 정보를 전달</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="147" x="309" y="960.6">- NAVER 계정 access token</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="112" x="309" y="978.36">- 클라이언트 인증 정보</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="354" x="315" y="996.12">(CLOVA_OAUTH_CLIENT_ID, CLOVA_OAUTH_CLIENT_SECRET)</text><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="299.5" y1="1063.72" y2="1059.72"/><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="299.5" y1="1063.72" y2="1067.72"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="289.5" x2="692.5" y1="1063.72" y2="1063.72"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="140" x="421.5" y="1047.88">CLOVA access token 전달</text><line style="stroke:#000000;stroke-width:1.0;" x1="803.5" x2="793.5" y1="1115.48" y2="1111.48"/><line style="stroke:#000000;stroke-width:1.0;" x1="803.5" x2="793.5" y1="1115.48" y2="1119.48"/><line style="stroke:#000000;stroke-width:1.0;" x1="289.5" x2="804.5" y1="1115.48" y2="1115.48"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="257" x="419" y="1099.64">CLOVA access token을 사용하여 CIC와 연결 시작</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="849" y1="1154.48" y2="1154.48"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="243" x="25" y="1178.4">["클라이언트 타입" == "GUI 미제공 클라이언"]</text><line style="stroke:#000000;stroke-width:1.0;" x1="109.5" x2="119.5" y1="1237" y2="1233"/><line style="stroke:#000000;stroke-width:1.0;" x1="109.5" x2="119.5" y1="1237" y2="1241"/><line style="stroke:#000000;stroke-width:1.0;" x1="109.5" x2="283.5" y1="1237" y2="1237"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="131" x="131.5" y="1221.16">authorization code 전달</text><line style="stroke:#000000;stroke-width:1.0;" x1="686.5" x2="676.5" y1="1342.04" y2="1338.04"/><line style="stroke:#000000;stroke-width:1.0;" x1="686.5" x2="676.5" y1="1342.04" y2="1346.04"/><line style="stroke:#000000;stroke-width:1.0;" x1="109.5" x2="687.5" y1="1342.04" y2="1342.04"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="229" x="219" y="1272.92">CLOVA access token 요청, 다음 정보를 전달</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="147" x="219" y="1290.68">- NAVER 계정 access token</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="112" x="219" y="1308.44">- 클라이언트 인증 정보</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="354" x="225" y="1326.2">(CLOVA_OAUTH_CLIENT_ID, CLOVA_OAUTH_CLIENT_SECRET)</text><line style="stroke:#000000;stroke-width:1.0;" x1="109.5" x2="119.5" y1="1393.8" y2="1389.8"/><line style="stroke:#000000;stroke-width:1.0;" x1="109.5" x2="119.5" y1="1393.8" y2="1397.8"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="109.5" x2="692.5" y1="1393.8" y2="1393.8"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="140" x="331.5" y="1377.96">CLOVA access token 전달</text><line style="stroke:#000000;stroke-width:1.0;" x1="803.5" x2="793.5" y1="1445.56" y2="1441.56"/><line style="stroke:#000000;stroke-width:1.0;" x1="803.5" x2="793.5" y1="1445.56" y2="1449.56"/><line style="stroke:#000000;stroke-width:1.0;" x1="109.5" x2="804.5" y1="1445.56" y2="1445.56"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacing" textLength="257" x="329" y="1429.72">CLOVA access token을 사용하여 CIC와 연결 시작</text><!--MD5=[39920c276fab788098c7c809094c4094]
@startuml
!include ../../../styles/PlantUML_StyleSheet.puml

participant "GUI 미제공 클라이언트" as device #9EA0CA
participant "GUI 제공 클라이언트" as app #9EA0CA
participant "NAVER 인증 서버" as nauth #05D686
participant "클라이언트 인증 서버" as cauth #05D686
participant CIC as cic #05D686

activate app
  app -> app: NAVER 로그인

  app ->> nauth: NAVER 계정 정보 전달

  activate nauth
    nauth - ->> app: NAVER 계정\naccess token 전달
  deactivate nauth

  app ->> cauth: authorization code 요청(다음 정보를 전달)\l- NAVER 계정 access token\l- 클라이언트 인증 정보(CLOVA_OAUTH_CLIENT_ID)

activate cauth

deactivate app

alt "사용자 약관 동의 여부" == "동의 완료한 상태"
    cauth - ->> app: authorization code 전달(200 OK)
    activate app
    deactivate app
else "사용자 약관 동의 여부" == "동의하지 않은 상태"
  cauth - ->> app: authorization, redirect_uri 전달\l(451 Unavailable For Legal Reasons)
  activate app
    app -> app: 이용 약관 페이지(redirect_uri)로 이동
    app ->> cauth: 사용자의 이용 약관 동의 결과 전송(submit)
    cauth - ->> app: 결과 전달(302 Found)\l- 성공: clova://agreement-success\l- 실패: clova://agreement-failure
  deactivate cauth
end

alt "클라이언트 타입" == "GUI 제공 클라이언트"
  app ->> cauth: CLOVA access token 요청, 다음 정보를 전달\l- NAVER 계정 access token\l- 클라이언트 인증 정보\l  (CLOVA_OAUTH_CLIENT_ID, CLOVA_OAUTH_CLIENT_SECRET)

  activate cauth
    cauth - ->> app: CLOVA access token 전달
  deactivate cauth

  app ->> cic: CLOVA access token을 사용하여 CIC와 연결 시작
  activate cic
  deactivate cic

else "클라이언트 타입" == "GUI 미제공 클라이언"
  app ->> device: authorization code 전달
  deactivate app

  activate device
    device ->> cauth: CLOVA access token 요청, 다음 정보를 전달\l- NAVER 계정 access token\l- 클라이언트 인증 정보\l  (CLOVA_OAUTH_CLIENT_ID, CLOVA_OAUTH_CLIENT_SECRET)

    activate cauth
        cauth - ->> device: CLOVA access token 전달
    deactivate cauth

    device ->> cic: CLOVA access token을 사용하여 CIC와 연결 시작

    activate cic
  end
@enduml

@startuml
scale max 880 width
skinparam sequenceMessageAlign center
skinparam shadowing false
skinparam roundcorner 10
skinparam padding 10
skinparam defaultFontSize 12
skinparam defaultFontName "Noto Sans CJK KR"

skinparam note {
  BackgroundColor #9EA0CA
  BorderColor #ffffff
  FontColor #ffffff
  FontSize 14
  FontStyle bold
}

skinparam sequence {
  ArrowColor #000000
  ActorBorderColor #000000
  ActorFontStyle Bolder


  LifeLineBorderColor #000000
  LifeLineBackgroundColor transparent
  ParticipantBorderColor transparent
  ParticipantFontSize 14
  ParticipantFontColor #ffffff
  ParticipantFontStyle bold

  BoxBorderColor #000000
  BoxFontColor #ffffff
    BoxFontSize 14
    BoxFontStyle bold
}
hide footbox

skinparam activity {
  BackgroundColor #9EA0CA
  BarColor #ffffff
  BorderColor #ffffff
  DiamondBackgroundColor #05D686
  DiamondBorderColor #ffffff
  DiamondFontColor #ffffff
  DiamondFontSize 14
  DiamondFontStyle bold
  FontColor #ffffff 
  FontSize 14
  FontStyle bold
}

participant "GUI 미제공 클라이언트" as device #9EA0CA
participant "GUI 제공 클라이언트" as app #9EA0CA
participant "NAVER 인증 서버" as nauth #05D686
participant "클라이언트 인증 서버" as cauth #05D686
participant CIC as cic #05D686

activate app
  app -> app: NAVER 로그인

  app ->> nauth: NAVER 계정 정보 전달

  activate nauth
    nauth - ->> app: NAVER 계정\naccess token 전달
  deactivate nauth

  app ->> cauth: authorization code 요청(다음 정보를 전달)\l- NAVER 계정 access token\l- 클라이언트 인증 정보(CLOVA_OAUTH_CLIENT_ID)

activate cauth

deactivate app

alt "사용자 약관 동의 여부" == "동의 완료한 상태"
    cauth - ->> app: authorization code 전달(200 OK)
    activate app
    deactivate app
else "사용자 약관 동의 여부" == "동의하지 않은 상태"
  cauth - ->> app: authorization, redirect_uri 전달\l(451 Unavailable For Legal Reasons)
  activate app
    app -> app: 이용 약관 페이지(redirect_uri)로 이동
    app ->> cauth: 사용자의 이용 약관 동의 결과 전송(submit)
    cauth - ->> app: 결과 전달(302 Found)\l- 성공: clova://agreement-success\l- 실패: clova://agreement-failure
  deactivate cauth
end

alt "클라이언트 타입" == "GUI 제공 클라이언트"
  app ->> cauth: CLOVA access token 요청, 다음 정보를 전달\l- NAVER 계정 access token\l- 클라이언트 인증 정보\l  (CLOVA_OAUTH_CLIENT_ID, CLOVA_OAUTH_CLIENT_SECRET)

  activate cauth
    cauth - ->> app: CLOVA access token 전달
  deactivate cauth

  app ->> cic: CLOVA access token을 사용하여 CIC와 연결 시작
  activate cic
  deactivate cic

else "클라이언트 타입" == "GUI 미제공 클라이언"
  app ->> device: authorization code 전달
  deactivate app

  activate device
    device ->> cauth: CLOVA access token 요청, 다음 정보를 전달\l- NAVER 계정 access token\l- 클라이언트 인증 정보\l  (CLOVA_OAUTH_CLIENT_ID, CLOVA_OAUTH_CLIENT_SECRET)

    activate cauth
        cauth - ->> device: CLOVA access token 전달
    deactivate cauth

    device ->> cic: CLOVA access token을 사용하여 CIC와 연결 시작

    activate cic
  end
@enduml

PlantUML version 1.2021.00(Sun Jan 10 19:25:05 KST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: KR
--></g></svg>